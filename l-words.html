<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بَيْن - الكلمات الدخيلة على العربية</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      font-family: 'Cairo', sans-serif;
    }

    body {
      margin: 0;
      background-color: #fff;
      color: #000;
      text-align: center;
    }

    /* حاويات التوب بار والفوتر */
    #topbar-container, #footer-container {
      width: 100%;
    }

    .container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      margin: 0 auto;
    }

    .tool-box {
      background-color: #73d8d8;
      border-radius: 20px;
      padding: 25px;
      width: 80%;
      max-width: 350px;
      margin: 40px auto;
    }

    .tool-box label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      text-align: center;
      margin-bottom: 15px;
    }

    button {
      width: 100%;
      padding: 10px;
      background-color: #6ef3f3;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      color: #000;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #4fc3c3;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    .results-section {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
    }

    .result-card {
      width: 85%;
      max-width: 450px;
      background-color: #eafafa;
      border: 2px solid #4fc3c3;
      border-radius: 15px;
      padding: 20px;
      text-align: right;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }

    .result-card:hover {
      transform: scale(1.02);
    }

    .arabic-word {
      font-size: 22px;
      font-weight: bold;
      color: #2a7e7e;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #4fc3c3;
    }

    .origin-label {
      display: inline-block;
      background-color: #4fc3c3;
      color: white;
      border-radius: 10px;
      padding: 5px 15px;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .meaning-label {
      display: inline-block;
      background-color: #f9a826;
      color: white;
      border-radius: 10px;
      padding: 5px 15px;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .origin, .meaning {
      margin: 5px 0 0 0;
      font-size: 18px;
      line-height: 1.6;
      color: #333;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    .error-message {
      background-color: #ffebee;
      border: 2px solid #f44336;
      border-radius: 15px;
      padding: 20px;
      margin: 20px;
      color: #d32f2f;
      font-weight: bold;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* تحسينات للشاشات الكبيرة */
    @media (min-width: 768px) {
      .container {
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }
      
      .tool-box {
        max-width: 500px;
        padding: 40px;
      }
      
      .results-section {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 30px;
      }
      
      .result-card {
        width: 45%;
        max-width: 500px;
      }
    }

    @media (min-width: 1024px) {
      .result-card {
        width: 30%;
      }
      
      .tool-box {
        max-width: 600px;
      }
    }
  </style>
</head>

<body>
  <!-- حاوية التوب بار الخارجي -->
  <div id="topbar-container"></div>

  <div class="container">
    <div class="tool-box">
      <label for="word-input">ابحث عن كلمة:</label>
      <input type="text" id="word-input" placeholder="اكتب الكلمة العربية...">

      <label for="origin-type">اختر الأصل:</label>
      <select id="origin-type">
        <option value="all">جميع الأصول</option>
        <option value="إنجليزي">إنجليزي</option>
        <option value="فرنسي">فرنسي</option>
        <option value="فارسي">فارسي</option>
        <option value="تركي">تركي</option>
        <option value="إيطالي">إيطالي</option>
        <option value="إسباني">إسباني</option>
        <option value="يوناني">يوناني</option>
        <option value="ألماني">ألماني</option>
        <option value="لاتيني">لاتيني</option>
        <option value="هندي">هندي</option>
      </select>

      <button id="search-btn">
        <span id="btn-text">بحث</span>
        <span id="btn-loading" class="loading" style="display: none;"></span>
      </button>
    </div>

    <div id="results-container" class="results-section">
      <!-- سيتم عرض النتائج هنا -->
    </div>
  </div>

  <!-- حاوية الفوتر الخارجي -->
  <div id="footer-container"></div>

  <script>
    // تحميل التوب بار الخارجي
    fetch("topbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("topbar-container").innerHTML = html;
      })
      .catch(err => console.error("فشل تحميل التوب بار:", err));

    // تحميل الفوتر الخارجي
    fetch("footer.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer-container").innerHTML = html;
      })
      .catch(err => console.error("فشل تحميل الفوتر:", err));

    // متغير لتخزين الكلمات بعد جلبها
    let borrowedWords = [];

    // عناصر DOM
    const searchBtn = document.getElementById('search-btn');
    const btnText = document.getElementById('btn-text');
    const btnLoading = document.getElementById('btn-loading');
    const input = document.getElementById('word-input');
    const originSelect = document.getElementById('origin-type');
    const resultsContainer = document.getElementById('results-container');

    // دالة لتفعيل/تعطيل زر البحث
    function toggleButtonState(loading) {
      if (loading) {
        searchBtn.disabled = true;
        btnText.style.display = 'none';
        btnLoading.style.display = 'inline-block';
      } else {
        searchBtn.disabled = false;
        btnText.style.display = 'inline-block';
        btnLoading.style.display = 'none';
      }
    }

    // دالة لجلب البيانات من ملف JSON
    async function loadBorrowedWords() {
      try {
        toggleButtonState(true);
        const response = await fetch('/data/loan.json');
        
        if (!response.ok) {
          throw new Error(`خطأ في جلب البيانات: ${response.status} ${response.statusText}`);
        }
        
        borrowedWords = await response.json();
        console.log(`تم تحميل ${borrowedWords.length} كلمة بنجاح`);
        
        // عرض جميع الكلمات بعد تحميلها
        displayWords(borrowedWords);
        toggleButtonState(false);
      } catch (error) {
        console.error('خطأ في جلب البيانات:', error);
        resultsContainer.innerHTML = `
          <div class="error-message">
            <p>❌ حدث خطأ في تحميل البيانات</p>
            <p>${error.message}</p>
            <p>يرجى التأكد من وجود ملف /data/loan.json</p>
          </div>
        `;
        toggleButtonState(false);
      }
    }

    // دالة لعرض الكلمات
    function displayWords(words) {
      resultsContainer.innerHTML = "";
      
      if (words.length === 0) {
        resultsContainer.innerHTML = `<p style="color:#888;">لم يتم العثور على نتائج تطابق البحث.</p>`;
        return;
      }

      words.forEach(word => {
        const card = document.createElement('div');
        card.className = 'result-card';
        
        let content = `
          <div class="arabic-word">${word.arabic}</div>
          <div class="origin-label">الأصل: ${word.origin}</div>
          ${word.original ? `<div class="origin">الكلمة الأصلية: ${word.original}</div>` : ''}
          <div class="meaning-label">المعنى أو الاستعمال</div>
          <div class="meaning">${word.meaning}</div>
        `;
        
        card.innerHTML = content;
        resultsContainer.appendChild(card);
      });
    }

    // دالة للبحث عن الكلمات
    function searchWords() {
      const searchTerm = input.value.trim().toLowerCase();
      const selectedOrigin = originSelect.value;
      
      // تفعيل حالة التحميل
      toggleButtonState(true);
      
      // محاكاة وقت التحميل لتحسين تجربة المستخدم
      setTimeout(() => {
        let filteredWords = borrowedWords;
        
        // تصفية حسب البحث النصي
        if (searchTerm) {
          filteredWords = filteredWords.filter(word => 
            word.arabic.toLowerCase().includes(searchTerm) || 
            (word.meaning && word.meaning.toLowerCase().includes(searchTerm)) ||
            (word.original && word.original.toLowerCase().includes(searchTerm))
          );
        }
        
        // تصفية حسب الأصل
        if (selectedOrigin !== "all") {
          filteredWords = filteredWords.filter(word => word.origin === selectedOrigin);
        }
        
        // عرض النتائج
        displayWords(filteredWords);
        
        // إلغاء حالة التحميل
        toggleButtonState(false);
      }, 300);
    }

    // معالج حدث البحث
    searchBtn.addEventListener('click', searchWords);

    // البحث أثناء الكتابة
    input.addEventListener('input', searchWords);

    // البحث عند تغيير نوع الأصل
    originSelect.addEventListener('change', searchWords);

    // تحميل البيانات عند تحميل الصفحة
    window.addEventListener('load', () => {
      loadBorrowedWords();
    });
  </script>
</body>
</html>
